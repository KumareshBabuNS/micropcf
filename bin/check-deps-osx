#!/bin/sh


function semver_greater_or_equal {
  first_major_version=$(echo $1 | cut -d '.' -f 1)
  first_minor_version=$(echo $1 | cut -d '.' -f 2)
  first_patch_version=$(echo $1 | cut -d '.' -f 3)

  second_major_version=$(echo $2 | cut -d '.' -f 1)
  second_minor_version=$(echo $2 | cut -d '.' -f 2)
  second_patch_version=$(echo $2 | cut -d '.' -f 3)

  if [[ first_major_version -gt second_major_version ]]; then
    echo 0
  elif [[ first_major_version -lt second_major_version ]]; then 
    echo 1
  else
    if [[ first_minor_version -gt second_minor_version ]]; then
      echo 0
    elif [[ first_minor_version -lt second_minor_version ]]; then 
      echo 1
    else
      if [[ first_patch_version -ge second_patch_version ]]; then
        echo 0
      else
        echo 1
      fi
    fi
  fi
}

which vagrant > /dev/null
if [[ $? -ne 0 ]]; then
  echo "vagrant missing"
  exit 1
fi

vagrant_version=$(vagrant --version | cut -f 2 -d ' ')
if [[ $(semver_greater_or_equal $vagrant_version 1.7.0) -eq 1 ]]; then
  echo "vagrant version must be greater than 1.7.0"
  exit 1
fi

which VBoxManage > /dev/null
if [[ $? -ne 0 ]]; then
  echo "virtualbox missing"
fi

virtualbox_version=$(VBoxManage --version | grep -o "[0-9]\+\.[0-9]\+\.[0-9]\+")
if [[ $(semver_greater_or_equal $virtualbox_version 5.0.0) -eq 1 ]]; then
  echo "Virtualbox version must be greater than 5.0.0"
  exit 1
fi

vmrun_path=$(which vmrun)
if [[ -z $vmrun_path ]]; then
  if [[ ! -f /Applications/VMware\ Fusion.app/Contents/Library/vmrun ]]; then
    echo "vmrun missing"
    exit 1
  fi
  vmrun_path=/Applications/VMware\ Fusion.app/Contents/Library/vmrun
fi

vmware_version=$("$vmrun_path" | grep version | cut -d ' ' -f 3)
if [[ $(semver_greater_or_equal $vmware_version 1.15.0) -eq 1 ]]; then
  echo "vmrun version must be greater than 1.15.0"
  exit 1
fi
